var listgo_singlelisting=function(e){"use strict";var t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=(function(){function e(e){this.value=e}function t(t){function i(n,s){try{var r=t[n](s),o=r.value;o instanceof e?Promise.resolve(o.value).then(function(e){i("next",e)},function(e){i("throw",e)}):a(r.done?"return":"normal",r.value)}catch(e){a("throw",e)}}function a(e,t){switch(e){case"return":n.resolve({value:t,done:!0});break;case"throw":n.reject(t);break;default:n.resolve({value:t,done:!1})}(n=n.next)?i(n.key,n.arg):s=null}var n,s;this._invoke=function(e,t){return new Promise(function(a,r){var o={key:e,arg:t,resolve:a,reject:r,next:null};s?s=s.next=o:(n=s=o,i(e,t))})},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),a=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),n=function(){function e(t,a,n){i(this,e),this.currentPage=n,this.totalPosts=t,this.postsPerPage=a,this.maxPages=0,this.oText=WILOKE_LISTGO_TRANSLATION}return a(e,[{key:"createPagination",value:function(){var e=[],t="";if(this.totalPosts=parseInt(this.totalPosts),this.postsPerPage=parseInt(this.postsPerPage),0===this.totalPosts||this.totalPosts<this.postsPerPage)return"";if(this.maxPages=Math.ceil(this.totalPosts/this.postsPerPage),this.maxPages<=1)return!1;if(this.currentPage=_.isUndefined(this.currentPage)?1:this.currentPage,this.maxPages<=8)for(var i=1;i<=this.maxPages;i++)e.push(i);else if(this.currentPage<=3)e=[1,2,3,4,"x",this.maxPages];else if(this.currentPage<7)e=[1,2,3,4,5,6,7,"x",this.maxPages];else{e=[1,"x"];for(var a=2;a>=0;a--)e.push(this.currentPage-a);if(this.maxPages-this.currentPage<=8)for(var n=this.currentPage+1;n<=this.maxPages;n++)e.push(n);else{for(var s=0;s<=2;s++)e.push(this.currentPage+1+s);e.push("x"),e.push(this.maxPages)}}for(var r=0,o=e.length;r<o;r++)this.currentPage===e[r]?t+='<a class="page-numbers current" data-page="'+e[r]+'">'+e[r]+"</a>":"x"===e[r]?t+='<a href="#" class="page-numbers dots">...</a>':t+='<a href="#" class="page-numbers"  data-page="'+e[r]+'">'+e[r]+"</a>";return""!==t&&(1!==this.currentPage&&(t+='<a href="#" class="prev page-numbers">'+this.oText.prev+"</a>"),this.currentPage!==this.maxPages&&(t+='<a href="#" class="next page-numbers">'+this.oText.next+"</a>")),t}}]),e}(),s=function(){function e(){i(this,e)}return a(e,null,[{key:"Android",value:function(){return navigator.userAgent.match(/Android/i)}},{key:"BlackBerry",value:function(){return navigator.userAgent.match(/BlackBerry/i)}},{key:"IOS",value:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)}},{key:"IPHONEIPOD",value:function(){return navigator.userAgent.match(/iPhone|iPod/i)}},{key:"Opera",value:function(){return navigator.userAgent.match(/Opera Mini/i)}},{key:"Windows",value:function(){return navigator.userAgent.match(/IEMobile/i)}},{key:"Any",value:function(){return this.Android()||this.BlackBerry()||this.IOS()||this.Opera()||this.Windows()}},{key:"exceptiPad",value:function(){return this.Android()||this.BlackBerry()||this.IPHONEIPOD()||this.Opera()||this.Windows()}}]),e}(),r=(function(){function e(){i(this,e)}a(e,null,[{key:"isIE",value:function(){return-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Trident")}}])}(),function(){function e(t,a){i(this,e);var n={moreButton:'<a href="#">'+WILOKE_LISTGO_TRANSLATION.more+"</a>",classMore:"item-menu-more",classMoreChild:"sub-menu-more sub-menu"};this.opts=this.wilExtend(n,a),this.els=document.querySelectorAll(t),this.create(this.els)}return a(e,[{key:"wilEach",value:function(e,t){for(var i=0,a=e.length;i<a&&i!==a;i++)t(e[i],i)}},{key:"wilExtend",value:function(e,i){return"object"===(void 0===i?"undefined":t(i))&&this.wilEach(Object.keys(i),function(t){e[t]=i[t]}),e}},{key:"create",value:function(e){var t=this;this.wilEach(e,function(e){e.style.display="inline-block",t.addMore(e),t.responsive(e)})}},{key:"addMore",value:function(e){var t=this.opts,i='\n            <li class="'+t.classMore+'">\n                '+t.moreButton+'\n                <ul class="'+t.classMoreChild+'"></ul>\n            </li>\n        ';-1===e.innerHTML.indexOf(t.moreButton)&&e.insertAdjacentHTML("beforeend",i)}},{key:"responsive",value:function(e){var t=e.children[e.children.length-1],i=t.lastElementChild,a=e.offsetWidth,n=t.offsetWidth,s=0;t.style.display="none",t.firstElementChild.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault()});var r=document.createEvent("Event");r.initEvent("eventResize",!0,!0),e.addEventListener("eventResize",function(){var r=window.innerWidth,o=e.offsetWidth,l=e.parentNode.offsetWidth;if(r>s)o+100<=l&&""!==i.innerHTML&&e.insertBefore(i.firstChild,e.childNodes[e.childNodes.length-2]),a+100+10<=l+n&&(t.style.display="none");else{var c=e.children[e.children.length-2];o+100>l&&void 0!==c&&i.insertBefore(c,i.firstChild),a+100+10>l+n&&(t.style.display="inline-block")}s=r});var o=setInterval(function(){e.offsetWidth+100>e.parentNode.offsetWidth?e.dispatchEvent(r):clearTimeout(o)},5);window.addEventListener("resize",function(){e.dispatchEvent(r)})}}]),e}()),o=function(){function e(t){i(this,e),this.$gallery=t,this.init()}return a(e,[{key:"init",value:function(){this.$gallery.length&&this.$gallery.each(function(){jQuery(this).magnificPopup({delegate:"a",type:"image",tLoading:"Loading image #%curr%...",mainClass:"mfp-with-zoom mfp-img-mobile",closeBtnInside:!1,closeMarkup:'<div class="popup-gallery__close pe-7s-close"></div>',gallery:{enabled:!0,navigateByImgClick:!0,preload:[0,1],tCounter:"%curr%/%total%"},image:{verticalFit:!0,tError:'<a href="%url%">The image #%curr%</a> could not be loaded.',titleSrc:function(e){if(void 0!==e.el.attr("data-title")){var t=e.el.attr("data-title");return _.isUndefined(e.el.data("linkto"))||(t='<a target="'+(_.isUndefined(e.el.attr("target"))?"_self":e.el.attr("target"))+'" href="'+e.el.data("linkto")+'">'+t+"</a>"),t}return""}}})})}}]),e}(),l=function(){function e(t){i(this,e),this.mapID=t,this.oListingsLatLng={},this.init()}return a(e,[{key:"mapStyles",value:function(e){if("custom"==e)return WILOKE_GLOBAL.googleMapThemeCode;var t={blurWater:[{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#444444"}]},{featureType:"landscape",elementType:"all",stylers:[{color:"#f2f2f2"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{saturation:-100},{lightness:45}]},{featureType:"road.highway",elementType:"all",stylers:[{visibility:"simplified"}]},{featureType:"road.arterial",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all",stylers:[{color:"#46bcec"},{visibility:"on"}]}],ultraLight:[{featureType:"water",elementType:"geometry",stylers:[{color:"#e9e9e9"},{lightness:17}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:20}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#ffffff"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#ffffff"},{lightness:16}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#f5f5f5"},{lightness:21}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#dedede"},{lightness:21}]},{elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#ffffff"},{lightness:16}]},{elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#333333"},{lightness:40}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#f2f2f2"},{lightness:19}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#fefefe"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#fefefe"},{lightness:17},{weight:1.2}]}],shadesOfGrey:[{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#000000"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#000000"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#000000"},{lightness:21}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#000000"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#000000"},{lightness:16}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"},{lightness:17}]}]};return void 0!==t[e]?t[e]:t.blurWater}},{key:"parseLatLng",value:function(e){var t=e.split(",");return{lat:parseFloat(t[0]),lng:parseFloat(t[1])}}},{key:"setParams",value:function(){var e={isSingle:"yes",icon:"",zoomControl:!0,scaleControl:!0,disableDoubleClickZoom:!1,streetViewControl:!0,overviewMapControl:!0,zoom:WILOKE_GLOBAL.mapSingleCenterZoom,maxZoom:WILOKE_GLOBAL.mapSingleMaxZoom,minZoom:WILOKE_GLOBAL.mapSingleMinZoom,styles:this.mapStyles(WILOKE_GLOBAL.googleMapThemeType)},t=this.$map.dataset;this.aConfiguration=Object.assign({},e,t),"no"==this.aConfiguration.isSingle&&(this.aConfiguration.zoom=WILOKE_GLOBAL.centerZoom,this.aConfiguration.maxZoom=WILOKE_GLOBAL.mapmaxzoom,this.aConfiguration.minZoom=WILOKE_GLOBAL.mapminzoom)}},{key:"createMapMaker",value:function(e,t){var i={position:e};return"undefined"!=typeof icon&&""!==icon&&(i.icon=icon),new google.maps.Marker(i)}},{key:"buildSingleMap",value:function(){if(void 0===this.aConfiguration.map)return alert("Latitude and Longitude are required"),!1;var e=this.parseLatLng(this.aConfiguration.map);this.aConfiguration.center=new google.maps.LatLng(e.lat,e.lng);var t=new google.maps.Map(this.$map,this.aConfiguration);this.createMapMaker(e,this.aConfiguration.marker).setMap(t)}},{key:"renderPopupContent",value:function(e){var t=this,i="";return _.isUndefined(e)||(i+='<div class="listing__content">',i+='<div class="address">',_.forEach(e,function(e,a){""===e||_.isUndefined(t.oText[a])||(e="phone_number"===a?'<a href="tel:'+e+'">'+e+"</a>":"contact_email"==a?'<a href="mailto:'+e+'">'+e+"</a>":'<a href="'+e+'" target="_blank">'+e+"</a>",i+='<span style="line-height: 20px;" class="address-'+a+'"><strong>'+t.oText[a]+":</strong> "+e+"</span>")}),i+="</div>",i+="</div>"),i}},{key:"popupTemplate",value:function(e){var t=e.featured_image?e.featured_image.main.src:"",i=this.renderPopupContent(e.listing_settings);return _.template('<div class="listing listing--grid" style="overflow-x:hidden; margin-bottom:0px">\n\t\t\t\t<div class="listing__media">\n\t\t\t\t\t<a href="<%- oItem.link %>" style="background-image: url(<%= featuredImage %>)"></a>\n\t\t\t\t\t<div class="listing__author">\n\t\t\t\t\t\t<a href="<%- oItem.author.link %>">\n\t\t\t\t\t\t<% if ( !_.isUndefined(oItem.author.user_first_character) ){ %>\n\t\t\t\t\t\t\t<span style="background-color: <%= oItem.author.avatar_color %>" class="widget_author__avatar-placeholder"><%- oItem.author.user_first_character %></span>\n\t\t\t\t\t\t<% }else{ %>\n\t\t\t\t\t\t\t<img src="<%- oItem.author.avatar %>" alt="<%- oItem.author.nickname %>">\n\t\t\t\t\t\t<% } %>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="listing__body">\n\t\t\t\t\t<h3 class="listing__title"><a href="<%- oItem.link %>"><%- oItem.title %></a></h3>\n\t\t\t\t\t<div class="listgo__rating">\n\t\t\t\t\t\t<span class="rating__star">\n\t\t\t\t\t\t\t<% for (var i = 1; i <= 5; i++){ \n\t\t\t\t\t\t\t\tvar className = \'\';\n\t\t\t\t\t\t\t\tif (oItem.average_rating < i ){\n\t\t\t\t\t\t\t\t\tclassName = i == Math.floor(oItem.average_rating) ? \'fa fa-star-half-o\' : \'fa fa-star-o\';\n\t\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\t\tclassName = \'fa fa-star\';\n\t\t\t\t\t\t\t\t}  %>\n\t\t\t\t\t\t\t\t<i class="<%- className %>"></i>\n\t\t\t\t\t\t\t<% } %>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<%= address %>\n\t\t\t\t\t</div>\n\t\t\t\t</div>')({oItem:e,address:i,featuredImage:t})}},{key:"parseLocations",value:function(){var e=this;this.$mapWrapper.find(".wiloke-listgo-listing-item").each(function(){var t=jQuery(this).data("info");if(t.listing_settings&&""!==t.listing_settings.map.latlong&&","!==t.listing_settings.map.latlong){e.aLocationsInfo.push(jQuery(this).data("info"));var i=e.parseLatLng(t.listing_settings.map.latlong);e.aLocations.push(i)}}),this.aLocations.length&&(this.aFistLocation=this.aLocations[0])}},{key:"addMarker",value:function(e,t,i,a){var n=this,s=new google.maps.InfoWindow({content:this.popupTemplate(a)}),r={position:e,map:this.oInitMap,title:a.title};void 0!==i&&""!==i&&(r.icon=i);var o=new google.maps.Marker(r);o.addListener("click",function(){null!=n.latestPopup&&n.latestPopup.close(),s.open(n.oInitMap,o),n.latestPopup=s}),this.aMarkers.push({postID:t,marker:o,infowindow:s}),this.oListingsLatLng[t]=e,this.aNewMarkers.push(o)}},{key:"showOnMap",value:function(e){if(!this.aMarkers.length)return!1;for(var t=0;t<this.aMarkers;t++)if(this.aMarkers[t].postID==e)return this.aMarkers[t].marker.setMap(this.oInitMap),!0;return!1}},{key:"hideAllMarkers",value:function(){for(var e=0;e<this.aMarkers.length;e++)this.aMarkers[e].marker.setMap(null)}},{key:"panTo",value:function(e){this.oInitMap.panTo(e)}},{key:"setupMapCluster",value:function(){if(""==WILOKE_GLOBAL.mapcluster)return!1;null!==this.aCluster?this.aNewMarkers.length&&this.aCluster.addMarkers(this.aNewMarkers):this.aCluster=new MarkerClusterer(this.oInitMap,this.aNewMarkers,{imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m",gridSize:WILOKE_GLOBAL.mapcluster,zoomOnClick:!0})}},{key:"addLayers",value:function(){for(var e=0;e<this.aLocations.length;e++)this.showOnMap(this.aLocationsInfo[e].ID)||this.addMarker(this.aLocations[e],this.aLocationsInfo[e].ID,this.aLocationsInfo[e].listing_cat_settings.map_marker_image,this.aLocationsInfo[e]);this.setupMapCluster()}},{key:"resetLocations",value:function(){this.aLocations=[],this.aLocationsInfo=[]}},{key:"updateMap",value:function(){var e=this;this.$listingLayout.on("ajax_completed",function(){e.$listingLayout.find(".wil-alert").length||(e.aNewMarkers=[],e.hideAllMarkers(),e.resetLocations(),e.parseLocations(),e.addLayers(),e.panTo(e.aFistLocation))})}},{key:"panToMarker",value:function(){var e=this;this.$listingLayout.on("click",".listgo_panto_marker",function(t){t.preventDefault();var i=jQuery(t.currentTarget).closest(".wiloke-listgo-listing-item").data("info");if(i.listing_settings&&""!==i.listing_settings.map.latlong&&","!==i.listing_settings.map.latlong){var a=e.parseLatLng(i.listing_settings.map.latlong);e.panTo(a);for(var n=0;n<e.aMarkers.length;n++)if(e.aMarkers[n].postID==i.ID)return null!==e.latestPopup&&e.latestPopup.close(),e.aMarkers[n].infowindow.open(e.oInitMap,e.aMarkers[n].marker),e.latestPopup=e.aMarkers[n].infowindow,!1}})}},{key:"buildMapCluster",value:function(){if(this.parseLocations(),this.aLocations.length){if(null===this.oInitMap){this.aConfiguration.center=this.aFistLocation,this.oInitMap=new google.maps.Map(this.$map,this.aConfiguration),this.addLayers(),this.updateMap(),this.panToMarker();var e=document.createElement("div");this.addCloseBtn(e),e.index=1,this.oInitMap.controls[google.maps.ControlPosition.TOP_RIGHT].push(e)}}else console.log("The LatLng is required")}},{key:"panToMarker",value:function(){var e=this;this.$listingLayout.on("click",".listgo_panto_marker",function(t){t.preventDefault(),e.$listingLayout.find(".listgo_panto_marker").addClass("active"),e.$map.classList.add("active");var i=jQuery(t.target).closest(".wiloke-listgo-listing-item").data("postid");void 0!==e.oListingsLatLng[i]&&e.panTo(e.oListingsLatLng[i])})}},{key:"addCloseBtn",value:function(e){var t=this,i=document.createElement("div");i.className="leaflet-bar leaflet-control leaflet-control-detect-mylocation";var a=document.createElement("div");a.style.color="red",a.style.background="black",a.style.fontFamily="FontAwesome",a.style.fontSize="16px",a.style.lineHeight="10px",a.style.paddingLeft="10px",a.style.paddingRight="10px",a.style.paddingTop="10px",a.style.paddingBottom="10px",a.innerHTML='<i class="fa fa-times"></i>',i.appendChild(a),e.appendChild(i),i.addEventListener("click",function(e){t.$map.classList.remove("active")})}},{key:"init",value:function(){if(this.$map=document.getElementById(this.mapID),this.oText=WILOKE_LISTGO_TRANSLATION,this.$mapWrapper=jQuery("#"+this.mapID).closest(".map-wrapper"),this.$listingLayout=this.$mapWrapper.find(".wiloke-listing-layout"),this.latestPopup=null,"undefined"===this.$map)return!1;this.aMarkers=[],this.aNewMarkers=[],this.aLocations=[],this.aLocationsInfo=[],this.aFistLocation=[],this.oInitMap=null,this.aCluster=null,this.setParams(),this.panToMarker(),"yes"==this.aConfiguration.isSingle?this.buildSingleMap():this.buildMapCluster()}}]),e}();return function(e){function t(){var t=e(".listing-single__wrap-header7 .listing-single__title");t.length&&t.textfill({maxFontPixels:30,innerTag:"h1",explicitHeight:60});var i=e(".listing-single-wrap7 .listing-single");i.length&&(i.on("onSinglelisting7",function(){var t=e(this),i=e(window).innerWidth(),a=e(".listing-single__wrap-header7"),n=a.innerHeight(),s=a.css("margin-top"),r=(a.css("margin-bottom"),n+parseInt(s));i>=992?t.css("margin-top",-r):t.css("margin-top","")}).trigger("onSinglelisting7"),e(window).on("resize",function(e){i.trigger("onSinglelisting7")}))}function c(){var t=e(".listing-single .listing-single-bar"),i=e(".listing-single .listing-single__tab");t.length&&t.on("ListingBarScroll",function(t){var a=e(this),n=e("#footer").offset().top,s=i.offset().top,r=(i.height(),e(window).height()),o=e(window).scrollTop();o>s&&o<=n-r-90?a.addClass("active"):a.removeClass("active")}).trigger("ListingBarScroll")}function u(){if(null!==navigator.userAgent.match(/iPad/i)){var t=e(".listing-single__sidebar"),i=e("#listgo-sidebar-placeholder"),a=e(".listgo-single-listing-sidebar-wrapper");e(window).width()>768?t.children().length&&a.appendTo(i):t.children().length||a.appendTo(t)}}function h(t){var i=e("#listing-single_listing_near_by");if(!i.length)return!1;jQuery.ajax({type:"POST",data:{action:"wiloke_get_listing_near_by_widget",latLng:t,postID:WILOKE_GLOBAL.postID},url:WILOKE_GLOBAL.ajaxurl,success:function(e){e.success?i.html(e.data):i.closest(".listing-single__related").remove()}})}function f(){var t=window.location.href;if(-1!==t.search("#tab-event")){var i="",a=e('a[href="#tab-event"]:first');if(-1!==t.search("--goto-")){var n=t.split("--goto-");i=e("#"+n[1])}a.trigger("click"),""!==i&&i.length&&setTimeout(function(){e("body, html").animate({scrollTop:i.offset().top-100},400)},500)}}var g=function(){function t(){i(this,t),this.$btnReview=e("#submit-review"),this.$previewGallery=null,this.init()}return a(t,[{key:"init",value:function(){if(this.$btnReview.length){this.$formRating=e("#form-rating"),this.xhr=null,this.xhrThanksReviewing=null,this.paged=1,this.orderBy="newest_first",this.xhrFetchComments=null,this.currentTabKey="wiloke_listgo_current_tab",this.currentReviewIDKey="wiloke_listgo_current_reviewID",this.aListFiles=[],this.aListingGalleryIDs=[],this.formData=null,this.isProcessData=!1,this.contentType=!1;var t=this,i=e("#upload_photos");this.$comments=e("#comments"),this.$showReview=this.$comments.find(".commentlist"),this.$paginationPlaceholder=e("#pagination-placeholder"),this.$orderBy=e("#comments_orderby"),this.$rating=this.$formRating.find("#rating"),this.autoSwitchToTab(),this.switchOrderBy(),this.switchPage(),this.scrollToReviewForm(),this.pagination(),this.selectRating(),this.thanksReviewing(),i.hasClass("is-using-media")||i.on("change",function(){t.aListFiles=this.files,t.showImageReview()}),null!==this.xhr&&200!==this.xhr.status&&this.xhr.abort(),this.$formRating.on("submit",function(a){a.preventDefault(),t.fetchImgGallery(),i.hasClass("is-using-media")?(t.formData=t.$formRating.serialize(),t.isProcessData=!0,t.contentType="application/x-www-form-urlencoded; charset=UTF-8"):t.formData=new FormData(e(this)[0]);var n=e(this),s=n.find("#title"),r=n.find("#review"),l=n.find("#username"),c=n.find("#upload_photos"),u=n.find("#preview-gallery"),h=n.find("#email"),f=n.find("#password");return n.addClass("loading"),t.$btnReview.addClass("loading"),""===s.val()?(s.parent().addClass("validate-required"),!1):""===r.val()?(r.parent().addClass("validate-required"),!1):h.length&&""===h.val()?(h.parent().addClass("validate-required"),!1):f.length&&""===f.val()?(f.parent().addClass("validate-required"),!1):void(t.xhr=e.ajax({type:"POST",url:WILOKE_GLOBAL.ajaxurl+"?action=wiloke_listgo_submit_review",async:!0,cache:t.isProcessData,contentType:t.contentType,processData:t.isProcessData,data:t.formData,success:function(i){i.success?("yes"===i.data.refresh?(localStorage.setItem(t.currentTabKey,"#tab-review"),localStorage.setItem(t.currentReviewIDKey,i.data.review_ID),location.reload()):(t.$btnReview.siblings(".review_status").html(i.data.message),t.$showReview.prepend(i.data.review),new o(t.$showReview.find(".popup-gallery")),setTimeout(function(){e("body, html").animate({scrollTop:t.$comments.find('.comment[data-reviewid="'+i.data.review_ID+'"]').offset().top},600)},1e3),t.$showReview.find(".lazy").Lazy()),s.val(""),r.val(""),l.val(""),c.val(""),u.html(""),t.$rating.val(5),t.$formRating.find(".comment__rate a").removeClass("active"),t.$formRating.find(".comment__rate a:last").addClass("active"),t.$btnReview.siblings(".review_status").html(""),t.$formRating.find("#wiloke-preview-gallery .bg-scroll").remove(),t.$formRating.find("#upload_photos").val(""),t.aListingGalleryIDs=[],h&&h.val("")):_.isUndefined(i.data)||(void 0!==i.data.alert?alert(i.data.alert):_.forEach(i.data,function(e,t){n.find("#"+t).parent().addClass("validate-required")})),n.removeClass("loading"),t.$btnReview.removeClass("loading")}}))})}}},{key:"fetchImgGallery",value:function(){if(this.$formRating.find("#wiloke-preview-gallery").length){var t=this;this.$formRating.find("#wiloke-preview-gallery .gallery-item.bg-scroll").each(function(){var i=e(this).data("id");void 0!==i&&t.aListingGalleryIDs.push(i)}),this.$formRating.find("#upload_photos").val(this.aListingGalleryIDs.join(","))}}},{key:"showImageReview",value:function(){if(this.aListFiles.length){var e=this.$formRating.find("#preview-gallery");e.html(""),_.each(this.aListFiles,function(t){if(/\.(jpe?g|png|gif)$/i.test(t.name)){var i=new FileReader,a=e.data("allow");i.addEventListener("load",function(){t.size<=1e6*a&&e.append('<a href="#" class="bg-scroll" style="background-image: url('+this.result+')"><img src="'+this.result+'"></a>')},!1),i.readAsDataURL(t)}})}}},{key:"validated",value:function(){this.$formRating.on("keydown","#email, #title, #review",function(t){var i=e(t.currentTarget),a=null;null!==a&&clearTimeout(a),a=setTimeout(function(){""!==i.val()?(i.parent().addClass("validate-required"),clearTimeout(a)):(i.parent().removeClass("validate-required"),clearTimeout(a))},300)})}},{key:"scrollToReviewForm",value:function(){e('a[href="#comment-respond"]').on("click",function(t){t.preventDefault(),e("body, html").animate({scrollTop:e("#comment-respond").offset().top},600)})}},{key:"autoSwitchToTab",value:function(){var t=localStorage.getItem(this.currentTabKey);if(t){e('a[href="'+t+'"]').trigger("click");var i=localStorage.getItem(this.currentReviewIDKey),a=e('[data-reviewid="'+i+'"]');a.length&&e("html, body").animate({scrollTop:a.offset().top},600),localStorage.removeItem(this.currentReviewIDKey),localStorage.removeItem(this.currentTabKey)}else{var n=window.location.href;if(-1!==n.search("#tab-review")){e('a[href="#tab-review"]').trigger("click");var s=n.split("&current-review=");if(_.isUndefined(s[1])){var r=e('[data-reviewid="'+s[1]+'"]');r.length&&e("html, body").animate({scrollTop:r.offset().top},600)}}}}},{key:"thanksReviewing",value:function(){var t=this;this.$comments.on("click",".wiloke-listgo-thanks-for-reviewing",function(i){i.preventDefault();var a=e(i.currentTarget);null!==t.xhrThanksReviewing&&200!==t.xhrThanksReviewing.status&&t.xhrThanksReviewing.abort();var n=a.find(".comment-like__count").text();n=parseInt(n,10),a.addClass("active disabled"),a.find(".comment-like__count").html(n+1),t.xhrThanksReviewing=e.ajax({type:"POST",url:WILOKE_GLOBAL.ajaxurl,data:{action:"wiloke_listgo_thanks_reviewing",post_ID:a.data("id"),security:WILOKE_GLOBAL.wiloke_nonce},success:function(e){}})})}},{key:"selectRating",value:function(){var t=this;this.$formRating.on("click",".comment__rate a",function(i){i.preventDefault();var a=e(i.currentTarget),n=a.parent();n.addClass("selected"),n.find(".active").removeClass("active"),a.addClass("active"),t.$rating.val(a.data("score"))})}},{key:"switchOrderBy",value:function(){var t=this;this.$orderBy.on("change",function(i){t.orderBy=e(i.currentTarget).find("option:selected").attr("value"),t.paged=1,t.$comments.addClass("loading"),t.fetchReviews()})}},{key:"pagination",value:function(){var e=this.$showReview.data("commentsperpage"),t=this.$showReview.data("totalcomments"),i=new n(t,e,this.paged);this.$paginationPlaceholder.html(i.createPagination())}},{key:"switchPage",value:function(){var t=this;this.$paginationPlaceholder.on("click",".page-numbers",function(i){i.preventDefault();var a=e(i.currentTarget);a.hasClass("prev")?t.paged=t.paged-1:a.hasClass("next")?t.paged=t.paged+1:t.paged=a.data("page"),e("html, body").animate({scrollTop:t.$comments.offset().top},600),t.$comments.addClass("loading"),t.fetchReviews()})}},{key:"fetchReviews",value:function(){var t=this;null!==this.xhrFetchComments&&200!==this.xhrFetchComments.status&&this.xhrFetchComments.abort(),this.xhrFetchComments=e.ajax({type:"POST",url:WILOKE_GLOBAL.ajaxurl,data:{action:"wiloke_listgo_fetch_new_reviews",paged:this.paged,security:WILOKE_GLOBAL.wiloke_nonce,orderBy:this.orderBy,post_ID:WILOKE_GLOBAL.postID},beforeSend:function(e){t.pagination()},success:function(i){i.success&&(t.$showReview.html(i.data.review),t.$showReview.find(".lazy").Lazy(),new o(t.$showReview.find(".popup-gallery"))),e("#comments").removeClass("loading")}})}}]),t}(),d=function(){function t(){i(this,t),this.totalView()}return a(t,[{key:"totalView",value:function(){if("listing"!==WILOKE_GLOBAL.post_type)return!1;var t=JSON.parse(WILOKE_GLOBAL.userInfo),i=void 0!==t.user_id?t.user_id:-1;setTimeout(function(){e.ajax({type:"POST",url:WILOKE_GLOBAL.ajaxurl,data:{action:"wiloke_submission_statistic_view",authorID:WILOKE_GLOBAL.authorID,listingID:WILOKE_GLOBAL.postID,security:WILOKE_GLOBAL.wiloke_nonce,currentUserID:i},success:function(e){}})},400)}}]),t}();e(document).ready(function(){s.Any()||(e("body").addClass("is-desktop"),new r(".listing-single .tab__nav",{moreButton:'<a href="#">'+WILOKE_LISTGO_TRANSLATION.more+"</a>",classMore:"item-menu-more",classMoreChild:"sub-menu-more sub-menu"}));var i=e(".widget-map");i.length&&new l(i.attr("id"));var a=e(".wiloke-listgo-map-shortcode");a.length&&new l(a.attr("id"));var n=!1;e(".tab__nav").on("click","a",function(t){e(t.currentTarget).closest("li").hasClass("has-single-map")&&!n&&setTimeout(function(){n=!0,new l(e(".listing-single__map").attr("id"))},300)}),c(),t();u(),e(window).on("resize",function(){0!==e(window).width()&&u()}),e("body").on("wiloke_listgo_user_latlng",function(e,t){h(t)}),new d,new g,f()})}(jQuery),{}}();